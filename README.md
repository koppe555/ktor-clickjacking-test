基本的にこちらの資料から引用 https://www.ipa.go.jp/files/000017316.pdf

# 概要
特定のページに対して、罠ページを上から配置し、視覚的に騙してユーザーが意図しない機能を実行させられること。
視覚的に騙して行う攻撃なので影響はクリック操作でできる範囲となる。


![](/img/20221109_クリックジャッキング_2022-11-09-05-56-11.png)

アプリケーションのバグではなくHTMLの仕様を悪用した攻撃方法。

## 具体例

**罠ページ**
→攻撃者が用意したサイト

**サイトA**
→twitter的なサービスとする。投稿にはログインが必要で、ユーザーはすでにログイン済みの状態。

ユーザーの興味を引くようなボタンが配置されている罠ページがある。
![](/img/20221109_クリックジャッキング_2022-11-09-09-02-58.png)

ボタンの上に、ユーザーから見えないようにiframeでサイトAが被さっている。
![](/img/20221109_クリックジャッキング_2022-11-09-09-05-03.png)


罠ページのボタンと、見ない状態のサイトAのボタンの位置が被っている。そのためユーザーは罠サイトのボタンをクリックしたつもりがサイトAのボタンをクリックしてしまう。
![](/img/20221109_クリックジャッキング_2022-11-09-09-07-10.png)

被さっているボタンが投稿ボタンでテキストを用意されていれば攻撃者の任意の投稿をさせられてしまう。


## 対策
HTTPレスポンスヘッダでiframeを使えないように設定する。

https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/X-Frame-Options

![](/img/20221109_クリックジャッキング_2022-11-09-09-13-25.png)

### ktorの場合

DefaultHeadersで設定できる。
https://ktor.io/docs/default-headers.html#add_dependencies

```
install(DefaultHeaders) {
        header("X-Frame-Options", "DENY")
    }
```

先ほどと同じアプリケーションに上記の設定を入れる。
![](/img/20221109_クリックジャッキング_2022-11-09-09-16-10.png)



iframeが許可されてないのでサイトAが表示されなくなる。
![](/img/20221109_クリックジャッキング_2022-11-09-09-17-36.png)
![](/img/20221109_クリックジャッキング_2022-11-09-09-17-02.png)
